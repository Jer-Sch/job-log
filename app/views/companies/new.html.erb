<%= form_for @company, url: {action: "create"} do |f| %>
  <%= f.label :name %>
  <%= f.text_field :name %>
  <%= f.fields_for :address do |a| %>
    <%= a.label :street_address, "Street Address" %>
    <%= a.text_field :street_address %>
    <%= a.label :city %>
    <%= a.text_field :city %>
    <%= a.label :state %>
    <%= a.text_field :state %>
    <%= a.label :zip_code, "Zip" %>
    <%= a.text_field :zip_code %>
  <% end %>
  <%= f.label :phone %>
  <%= f.telephone_field :telephone_number %>
  <%= f.label :contact_person, "Contact Person" %>
  <%= f.text_field :contact_person %>
  <%= f.hidden_field :user_id, :value => @user.id %>
  <%= f.submit "Submit Company" %>
<% end %>

<div id="show-company">
  <div id="company-name"></div>
  <div id="company-street-address"></div>
  <div id="company-city"></div>
  <div id="company-state"></div>
  <div id="company-zip-code"></div>
  <div id="company-telephone"></div>
  <div id="company-contact"></div>
</div>

<%= link_to("Sign Out", logout_path, method: :delete) %>

<script type="text/javascript" charset="utf-8">
    $(function() {
      setupCreateNewCompany();
    });

    function createNewCompany(url, data) {
      $.post(url, data, "json")
       .done(json => {
         let newCompany = new Company(json);
         newCompany.updateHTML();
      });
    };

    class Company {
      constructor(json) {
        this.data = json;
      }
      updateHTML() {
        $("#company-name").text(this.data.name);
        $("#company-street_address").text(this.data.street_address);
        $("#company-city").text(this.data.city);
        $("#company-state").text(this.data.state);
        $("#company-zip-code").text(this.data.zip_code);
        $("#company-telephone").text(this.data.telephone_number);
        $("#company-contact").text(this.data.contact_person);
      };
    };

    function setupCreateNewCompany() {
      $("form").submit(function(event) {
        event.preventDefault();

        let inputValues = $(this).serialize();
        let url = $(this).attr("action");

        createNewCompany(url, inputValues);
      });
    };
</script>
